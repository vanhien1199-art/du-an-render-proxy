<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Học liệu KHTN 7: Đo Tốc Độ</title>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        /* ... phần css của bạn ... */
    </style>
</head>
<body>
    <header>
        <h1>Bài học: Đo Tốc Độ</h1>
        <p>KHTN 7 - Bộ sách Kết nối tri thức</p>
    </header>
    <main>
        <section id="muc-tieu" class="card">
             <h2>🎯 Mục tiêu bài học</h2>
            <ul>
                <li>Nêu được khái niệm tốc độ, ý nghĩa của tốc độ.</li>
                <li>Viết được công thức tính tốc độ.</li>
                <li>Vận dụng công thức để giải các bài tập tính tốc độ, quãng đường, thời gian đơn giản.</li>
            </ul>
        </section>
        <section id="kien-thuc" class="card">
            <h2>📚 Kiến thức cần ghi nhớ</h2>
            <h3>1. Khái niệm Tốc độ</h3>
            <p>Tốc độ cho biết mức độ nhanh hay chậm của chuyển động. Tốc độ được xác định bằng quãng đường đi được trong một đơn vị thời gian.</p>
            <h3>2. Công thức tính tốc độ</h3>
            <div style="background: #eef; padding: 15px; border-radius: 5px; text-align: center; font-size: 1.2em; font-weight: bold; margin: 15px 0;">v = s / t</div>
            <p><strong>Trong đó:</strong></p>
            <ul><li><b>v:</b> là tốc độ</li><li><b>s:</b> là quãng đường</li><li><b>t:</b> là thời gian</li></ul>
            <h3>3. Đơn vị đo tốc độ</h3>
            <p>Đơn vị hợp pháp trong hệ đo lường SI là <strong>mét trên giây (m/s)</strong>. Trong thực tế, người ta thường dùng <strong>kilômét trên giờ (km/h)</strong>. (1 m/s = 3.6 km/h)</p>
        </section>
        <section id="ai-chatbot-card" class="card">
            <h2>🤖 Trợ lý AI - Hỏi đáp về bài học</h2>
            <p>Có điều gì về bài học "Đo Tốc độ" mà em chưa hiểu? Hãy hỏi Trợ lý AI nhé!</p>
            <div id="chatArea">
                <div class="chat-window" id="chat-window">
                    <div class="chat-message ai-message">Xin chào! Tôi có thể giúp gì cho bạn?</div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="user-input" placeholder="Nhập câu hỏi của bạn..." onkeydown="if(event.key === 'Enter') askAI()">
                    <button onclick="askAI()">Gửi</button>
                </div>
            </div>
        </section>
        <section id="bai-tap" class="card interactive-section">
             <h2>🛠️ Bài tập vận dụng: Máy tính tốc độ</h2>
             <div class="form-group"><label for="distance">Quãng đường (s):</label><input type="number" id="distance" placeholder="Ví dụ: 100"></div>
             <div class="form-group"><label for="distanceUnit">Đơn vị:</label><select id="distanceUnit" style="width:100%; padding:12px; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem;"><option value="m">mét (m)</option><option value="km">kilômét (km)</option></select></div>
             <div class="form-group"><label for="time">Thời gian (t):</label><input type="number" id="time" placeholder="Ví dụ: 10"></div>
             <div class="form-group"><label for="timeUnit">Đơn vị:</label><select id="timeUnit" style="width:100%; padding:12px; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem;"><option value="s">giây (s)</option><option value="h">giờ (h)</option></select></div>
             <button onclick="calculateSpeed()">Tính tốc độ</button>
             <div id="speedResult" style="display: none;"></div>
        </section>
        <section id="quiz" class="card">
            <h2>🧠 Mini Quiz: Kiểm tra nhanh</h2>
            <form id="quizForm">
                <div class="quiz-question"><p>Câu 1: Đại lượng nào cho biết mức độ nhanh hay chậm của chuyển động?</p><div class="quiz-options"><label><input type="radio" name="q1" value="b"> Tốc độ</label><label><input type="radio" name="q1" value="a"> Quãng đường</label><label><input type="radio" name="q1" value="c"> Thời gian</label></div></div>
                <div class="quiz-question"><p>Câu 2: Công thức tính tốc độ là gì?</p><div class="quiz-options"><label><input type="radio" name="q2" value="c"> v = s / t</label><label><input type="radio" name="q2" value="a"> v = s * t</label><label><input type="radio" name="q2" value="b"> v = t / s</label></div></div>
                <div class="quiz-question"><p>Câu 3: Một người đi xe đạp 18 km hết 1.5 giờ. Tốc độ là bao nhiêu?</p><div class="quiz-options"><label><input type="radio" name="q3" value="a"> 12 km/h</label><label><input type="radio" name="q3" value="b"> 27 km/h</label><label><input type="radio" name="q3" value="c"> 18 km/h</label></div></div>
                <div class="quiz-question"><p>Câu 4: Đơn vị đo tốc độ trong hệ SI là gì?</p><div class="quiz-options"><label><input type="radio" name="q4" value="b"> m/s</label><label><input type="radio" name="q4" value="a"> km/h</label><label><input type="radio" name="q4" value="c"> cm/s</label></div></div>
                <button type="submit">Nộp bài</button>
            </form>
            <div id="quizResult" style="display: none;"></div>
        </section>
    </main>

    <script>
        // --- Hàm tính tốc độ ---
        function calculateSpeed(){const s=parseFloat(document.getElementById("distance").value),sUnit=document.getElementById("distanceUnit").value,t=parseFloat(document.getElementById("time").value),tUnit=document.getElementById("timeUnit").value,resultDiv=document.getElementById("speedResult");if(isNaN(s)||isNaN(t))return resultDiv.innerHTML="Vui lòng nhập số hợp lệ!",resultDiv.style.backgroundColor="var(--error-color)",resultDiv.style.color="white",void(resultDiv.style.display="block");if(t<=0)return resultDiv.innerHTML="Thời gian phải lớn hơn 0!",resultDiv.style.backgroundColor="var(--error-color)",resultDiv.style.color="white",void(resultDiv.style.display="block");let finalUnit="";if("m"===sUnit&&"s"===tUnit)finalUnit="m/s";else{if("km"!==sUnit||"h"!==tUnit)return resultDiv.innerHTML=`Không thể tính trực tiếp với đơn vị ${sUnit}/${tUnit}.`,resultDiv.style.backgroundColor="var(--error-color)",resultDiv.style.color="white",void(resultDiv.style.display="block");finalUnit="km/h"}const speed=s/t;resultDiv.innerHTML=`Tốc độ tính được là: <strong>${speed.toFixed(2)} ${finalUnit}</strong>`,resultDiv.style.backgroundColor="var(--success-color)",resultDiv.style.color="white",resultDiv.style.display="block"}
        
        // --- Hàm chấm quiz ---
        const quizForm=document.getElementById("quizForm");quizForm.addEventListener("submit",function(e){e.preventDefault();const t={q1:"b",q2:"c",q3:"a",q4:"b"};let l=0;const o=Object.keys(t).length,r={q1:quizForm.elements.q1.value,q2:quizForm.elements.q2.value,q3:quizForm.elements.q3.value,q4:quizForm.elements.q4.value};for(const c in r)r[c]===t[c]&&l++;const s=document.getElementById("quizResult");s.innerHTML=`Kết quả của bạn: <strong>${l} / ${o}</strong> câu đúng.`,s.style.display="block",l===o?(s.innerHTML+="<br>🎉 Chúc mừng! Em đã nắm rất vững bài học!",s.style.backgroundColor="var(--success-color)",s.style.color="white"):(s.innerHTML+="<br>Hãy xem lại phần kiến thức để hiểu rõ hơn nhé!",s.style.backgroundColor="var(--secondary-color)",s.style.color="white")});
        
        // --- Các hàm cho AI Chatbot ---
        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');

        // *** DÒNG QUAN TRỌNG NHẤT - ĐÃ SỬA ĐÚNG URL CỦA THẦY/CÔ ***
        const AI_SERVICE_URL = 'https://du-an-render-proxy.onrender.com';

        async function askAI() {
            const question = userInput.value.trim();
            if (!question) return;

            addMessageToChat(question, 'user-message');
            userInput.value = '';
            const waitingMessage = addMessageToChat('Trợ lý AI đang suy nghĩ...', 'ai-message');

            try {
                const response = await fetch(`${AI_SERVICE_URL}/ask`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: question })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Lỗi không xác định');
                }

                const data = await response.json();
                waitingMessage.innerHTML = marked.parse(data.answer);
            } catch (error) {
                console.error("Lỗi:", error);
                waitingMessage.textContent = `Xin lỗi, đã có lỗi: ${error.message}`;
            }
        }

        function addMessageToChat(text, className) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message', className);
            messageElement.innerHTML = text;
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            return messageElement;
        }
    </script>
</body>
</html>

